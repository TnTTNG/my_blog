<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>基于 Docker + Prometheus + Grafana 的全栈监控平台 | (´▽`ʃ♡ƪ)</title><meta name="author" content="ZhanHui TnTTNG"><meta name="copyright" content="ZhanHui TnTTNG"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="项目背景与架构 项目目标：在单台云服务器上构建轻量级、高可用的运维监控体系，解决“服务器黑盒”问题，实现对主机硬件及 Docker 容器的实时监控。 技术栈：Docker, Docker Compose, Prometheus, Grafana, Node Exporter, cAdvisor。 架构流向：   数据源 (Node Exporter&#x2F;cAdvisor) -&gt; 拉取存">
<meta property="og:type" content="article">
<meta property="og:title" content="基于 Docker + Prometheus + Grafana 的全栈监控平台">
<meta property="og:url" content="https://github.com/TnTTNG/2026/01/31/%E5%9F%BA%E4%BA%8E%20Docker%20+%20Prometheus%20+%20Grafana%20%E7%9A%84%E5%85%A8%E6%A0%88%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/index.html">
<meta property="og:site_name" content="(´▽&#96;ʃ♡ƪ)">
<meta property="og:description" content="项目背景与架构 项目目标：在单台云服务器上构建轻量级、高可用的运维监控体系，解决“服务器黑盒”问题，实现对主机硬件及 Docker 容器的实时监控。 技术栈：Docker, Docker Compose, Prometheus, Grafana, Node Exporter, cAdvisor。 架构流向：   数据源 (Node Exporter&#x2F;cAdvisor) -&gt; 拉取存">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/TnTTNG/img/brain.jpg">
<meta property="article:published_time" content="2026-01-31T12:31:00.000Z">
<meta property="article:modified_time" content="2026-02-04T15:39:37.167Z">
<meta property="article:author" content="ZhanHui TnTTNG">
<meta property="article:tag" content="教程">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/TnTTNG/img/brain.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "基于 Docker + Prometheus + Grafana 的全栈监控平台",
  "url": "https://github.com/TnTTNG/2026/01/31/%E5%9F%BA%E4%BA%8E%20Docker%20+%20Prometheus%20+%20Grafana%20%E7%9A%84%E5%85%A8%E6%A0%88%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/",
  "image": "https://github.com/TnTTNG/img/brain.jpg",
  "datePublished": "2026-01-31T12:31:00.000Z",
  "dateModified": "2026-02-04T15:39:37.167Z",
  "author": [
    {
      "@type": "Person",
      "name": "ZhanHui TnTTNG",
      "url": "https://github.com/TnTTNG"
    }
  ]
}</script><link rel="shortcut icon" href="/TnTTNG/img/brain.png"><link rel="canonical" href="https://github.com/TnTTNG/2026/01/31/%E5%9F%BA%E4%BA%8E%20Docker%20+%20Prometheus%20+%20Grafana%20%E7%9A%84%E5%85%A8%E6%A0%88%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/TnTTNG/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/TnTTNG/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '基于 Docker + Prometheus + Grafana 的全栈监控平台',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="bg-animation" id="web_bg" style="background-image: url(https://my-static-website-bucket.oss-cn-guangzhou.aliyuncs.com/stewie-griffin-smirk-vi3r1fbdetfuir8e.jpg);"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://my-static-website-bucket.oss-cn-guangzhou.aliyuncs.com/stewie-griffin-smirk-vi3r1fbdetfuir8e.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/TnTTNG/"><span class="site-name">(´▽`ʃ♡ƪ)</span></a><a class="nav-page-title" href="/TnTTNG/"><span class="site-name">基于 Docker + Prometheus + Grafana 的全栈监控平台</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">基于 Docker + Prometheus + Grafana 的全栈监控平台</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-01-31T12:31:00.000Z" title="发表于 2026-01-31 20:31:00">2026-01-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-04T15:39:37.167Z" title="更新于 2026-02-04 23:39:37">2026-02-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/TnTTNG/categories/%E7%B3%BB%E7%BB%9F%E6%90%AD%E5%BB%BA/">系统搭建</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="项目背景与架构"><a href="#项目背景与架构" class="headerlink" title="项目背景与架构"></a>项目背景与架构</h2><ul>
<li><strong>项目目标</strong>：在单台云服务器上构建轻量级、高可用的运维监控体系，解决“服务器黑盒”问题，实现对主机硬件及 Docker 容器的实时监控。</li>
<li><strong>技术栈</strong>：Docker, Docker Compose, Prometheus, Grafana, Node Exporter, cAdvisor。</li>
<li><strong>架构流向</strong>：</li>
</ul>
<blockquote>
<p>数据源 (Node Exporter&#x2F;cAdvisor) -&gt; 拉取存储 (Prometheus) -&gt; 数据展示 (Grafana)</p>
</blockquote>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>确保服务器已安装 <code>Docker</code> 和 <code>Docker Compose</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建统一的项目目录，遵循运维规范</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/monitor/prometheus  <span class="comment"># 存放 Prometheus 配置</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /opt/monitor/grafana     <span class="comment"># 存放 Grafana 持久化数据</span></span><br><span class="line"><span class="built_in">cd</span> /opt/monitor</span><br></pre></td></tr></table></figure>

<h2 id="配置文件编写"><a href="#配置文件编写" class="headerlink" title="配置文件编写"></a>配置文件编写</h2><h3 id="配置-Prometheus-prometheus-yml"><a href="#配置-Prometheus-prometheus-yml" class="headerlink" title="配置 Prometheus (prometheus.yml)"></a>配置 Prometheus (<code>prometheus.yml</code>)</h3><p>创建并编辑 <code>/opt/monitor/prometheus/prometheus.yml</code>，定义数据抓取任务。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span>      <span class="comment"># 全局抓取间隔</span></span><br><span class="line">  <span class="attr">evaluation_interval:</span> <span class="string">15s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="comment"># 1. 监控 Prometheus 自身</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 2. 监控宿主机硬件 (Node Exporter)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;node_exporter&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;node-exporter:9100&#x27;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 3. 监控 Docker 容器资源 (cAdvisor)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;cadvisor&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;cadvisor:8080&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="编写编排文件-docker-compose-yml"><a href="#编写编排文件-docker-compose-yml" class="headerlink" title="编写编排文件 (docker-compose.yml)"></a>编写编排文件 (<code>docker-compose.yml</code>)</h3><p>在 <code>/opt/monitor/</code> 下创建，一次性编排所有服务。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="comment"># --- 核心数据库: Prometheus ---</span></span><br><span class="line">  <span class="attr">prometheus:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">prom/prometheus:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">prometheus_data:/prometheus</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--config.file=/etc/prometheus/prometheus.yml&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--storage.tsdb.retention.time=15d&#x27;</span> <span class="comment"># 数据保留15天</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9090:9090&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">monitor-net</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># --- 可视化面板: Grafana ---</span></span><br><span class="line">  <span class="attr">grafana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/grafana:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">grafana</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">grafana_data:/var/lib/grafana</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GF_SECURITY_ADMIN_PASSWORD=admin</span> <span class="comment"># 初始密码</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">monitor-net</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># --- 宿主机采集器: Node Exporter ---</span></span><br><span class="line">  <span class="attr">node-exporter:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">prom/node-exporter:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">node-exporter</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9100:9100&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/proc:/host/proc:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/sys:/host/sys:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/:/rootfs:ro</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--path.procfs=/host/proc&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--path.sysfs=/host/sys&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--path.rootfs=/rootfs&#x27;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">monitor-net</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># --- 容器采集器: cAdvisor ---</span></span><br><span class="line">  <span class="attr">cadvisor:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zcube/cadvisor:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">cadvisor</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">devices:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/dev/kmsg</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/:/rootfs:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run:/var/run:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/sys:/sys:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/lib/docker/:/var/lib/docker:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/dev/disk/:/dev/disk:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/sys/fs/cgroup:/sys/fs/cgroup:ro</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">monitor-net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">prometheus_data:</span></span><br><span class="line">  <span class="attr">grafana_data:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">monitor-net:</span></span><br></pre></td></tr></table></figure>

<h2 id="部署与启动"><a href="#部署与启动" class="headerlink" title="部署与启动"></a>部署与启动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 /opt/monitor 目录下执行</span></span><br><span class="line">docker compose up -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查运行状态（确保所有 State 均为 Up）</span></span><br><span class="line">docker compose ps</span><br></pre></td></tr></table></figure>

<h2 id="Grafana-深度配置与可视化"><a href="#Grafana-深度配置与可视化" class="headerlink" title="Grafana 深度配置与可视化"></a>Grafana 深度配置与可视化</h2><p>访问地址：<code>http://&lt;服务器IP&gt;:3000</code> (账号&#x2F;密码: admin&#x2F;admin)</p>
<h3 id="设置中文界面"><a href="#设置中文界面" class="headerlink" title="设置中文界面"></a>设置中文界面</h3><ol>
<li>进入 <strong>Profile (个人资料)</strong> -&gt; <strong>Preferences</strong>。</li>
<li><strong>Language</strong> 选择 <strong>简体中文</strong> -&gt; Save。</li>
</ol>
<h3 id="配置数据源"><a href="#配置数据源" class="headerlink" title="配置数据源"></a>配置数据源</h3><ol>
<li>左侧菜单 -&gt; <strong>连接</strong> -&gt; <strong>数据源</strong> -&gt; <strong>Add new data source</strong>。</li>
<li>选择 <strong>Prometheus</strong>。</li>
<li><strong>Connection URL</strong> 填写：<code>http://prometheus:9090</code> (利用 Docker 内部 DNS 解析)。</li>
<li>点击底部 <strong>Save &amp; Test</strong>，出现绿色提示即成功。</li>
</ol>
<h3 id="导入核心仪表盘"><a href="#导入核心仪表盘" class="headerlink" title="导入核心仪表盘"></a>导入核心仪表盘</h3><p>左侧菜单 -&gt; <strong>仪表盘</strong> -&gt; **导入 (Import)**，输入以下 ID 并加载：</p>
<table>
<thead>
<tr>
<th>监控维度</th>
<th>推荐模板 ID</th>
<th>关键指标</th>
</tr>
</thead>
<tbody><tr>
<td><strong>宿主机监控</strong> (Node Exporter)</td>
<td><strong>8919</strong></td>
<td>CPU 核数负载、内存明细、磁盘 I&#x2F;O 读写、网络上下行流量</td>
</tr>
<tr>
<td><strong>Docker 容器监控</strong> (cAdvisor)</td>
<td><strong>14282</strong> (或 193)</td>
<td>单容器 CPU 使用率、单容器内存占用、网络流量排行</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>注意</strong>：导入时在底部的 Data Source 选项中，务必选择刚刚创建的 Prometheus 数据源。</p>
</blockquote>
<h2 id="基于-Alertmanager-的自动化告警闭环"><a href="#基于-Alertmanager-的自动化告警闭环" class="headerlink" title="基于 Alertmanager 的自动化告警闭环"></a>基于 Alertmanager 的自动化告警闭环</h2><blockquote>
<p>为了实现 7*24 小时无人值守监控，我们引入 Alertmanager 组件</p>
</blockquote>
<p>流程：Prometheus (发现异常) -&gt; Push -&gt; Alertmanager (去重、分组、路由) -&gt; Send -&gt; Email (管理员)。</p>
<h3 id="配置文件编写-1"><a href="#配置文件编写-1" class="headerlink" title="配置文件编写"></a>配置文件编写</h3><h4 id="创建告警规则-rules-yml"><a href="#创建告警规则-rules-yml" class="headerlink" title="创建告警规则 (rules.yml)"></a>创建告警规则 (<code>rules.yml</code>)</h4><p>在 &#x2F;opt&#x2F;monitor&#x2F;prometheus&#x2F; 目录下创建 <code>rules.yml</code>，定义什么样的指标属于“故障”。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">groups</span>:</span><br><span class="line">  - name: host_monitoring</span><br><span class="line">    rules:</span><br><span class="line">    - alert: HostCpuUsageTooHigh</span><br><span class="line">      <span class="comment"># 表达式含义：(1 - 空闲率) * 100 &gt; 50%</span></span><br><span class="line">      <span class="built_in">expr</span>: 100 - (avg by (instance) (rate(node_cpu_seconds_total&#123;mode=<span class="string">&quot;idle&quot;</span>&#125;[1m])) * 100) &gt; 50</span><br><span class="line">      <span class="keyword">for</span>: 1m  <span class="comment"># 持续 1 分钟才报警，避免抖动误报</span></span><br><span class="line">      labels:</span><br><span class="line">        severity: warning</span><br><span class="line">      annotations:</span><br><span class="line">        summary: <span class="string">&quot;主机 &#123;&#123; <span class="variable">$labels</span>.instance &#125;&#125; CPU 负载过高&quot;</span></span><br><span class="line">        description: <span class="string">&quot;当前 CPU 使用率已超过 50% (当前值: &#123;&#123; <span class="variable">$value</span> | printf \&quot;%.2f\&quot; &#125;&#125;%)&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="配置-Alertmanager-config-yml"><a href="#配置-Alertmanager-config-yml" class="headerlink" title="配置 Alertmanager (config.yml)"></a>配置 Alertmanager (<code>config.yml</code>)</h4><p>创建目录 <code>/opt/monitor/alertmanager </code>并新建<code>config.yml</code>。</p>
<blockquote>
<p>注意：此处以 QQ 邮箱为例，密码必须使用 SMTP 授权码。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">global:</span><br><span class="line">  resolve_timeout: 5m</span><br><span class="line">  smtp_smarthost: <span class="string">&#x27;smtp.qq.com:465&#x27;</span>      <span class="comment"># SMTP 服务器</span></span><br><span class="line">  smtp_from: <span class="string">&#x27;你的邮箱@qq.com&#x27;</span>           <span class="comment"># 发件人</span></span><br><span class="line">  smtp_auth_username: <span class="string">&#x27;你的邮箱@qq.com&#x27;</span>  <span class="comment"># 账号</span></span><br><span class="line">  smtp_auth_password: <span class="string">&#x27;你的授权码&#x27;</span>       <span class="comment"># 授权码 (非登录密码)</span></span><br><span class="line">  smtp_require_tls: <span class="literal">false</span>                <span class="comment"># 465端口通常为false</span></span><br><span class="line"></span><br><span class="line">route:</span><br><span class="line">  group_by: [<span class="string">&#x27;alertname&#x27;</span>]</span><br><span class="line">  group_wait: 10s</span><br><span class="line">  group_interval: 10s</span><br><span class="line">  repeat_interval: 1h       <span class="comment"># 报警未解决，1小时后重发</span></span><br><span class="line">  receiver: <span class="string">&#x27;email-receiver&#x27;</span></span><br><span class="line"></span><br><span class="line">receivers:</span><br><span class="line">  - name: <span class="string">&#x27;email-receiver&#x27;</span></span><br><span class="line">    email_configs:</span><br><span class="line">      - to: <span class="string">&#x27;接收者邮箱@example.com&#x27;</span></span><br><span class="line">        send_resolved: <span class="literal">true</span> <span class="comment"># 故障恢复后发送通知</span></span><br><span class="line">        headers:</span><br><span class="line">          Subject: <span class="string">&quot;【云服务器告警】 &#123;&#123; .CommonAnnotations.summary &#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="关联-Prometheus"><a href="#关联-Prometheus" class="headerlink" title="关联 Prometheus"></a>关联 Prometheus</h4><p>修改 <code>/opt/monitor/prometheus/prometheus.yml</code>，加入规则文件和 Alertmanager 地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 global 块之后添加</span></span><br><span class="line">rule_files:</span><br><span class="line">  - <span class="string">&quot;rules.yml&quot;</span>  <span class="comment"># 引用刚刚写的规则文件</span></span><br><span class="line"></span><br><span class="line">alerting:</span><br><span class="line">  alertmanagers:</span><br><span class="line">    - static_configs:</span><br><span class="line">        - targets: [<span class="string">&#x27;alertmanager:9093&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="服务编排更新-docker-compose-yml"><a href="#服务编排更新-docker-compose-yml" class="headerlink" title="服务编排更新 (docker-compose.yml)"></a>服务编排更新 (<code>docker-compose.yml</code>)</h3><p>修改 <code>/opt/monitor/docker-compose.yml</code>，新增 Alertmanager 服务，并更新 Prometheus 的挂载。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  <span class="comment"># ... (其他服务保持不变) ...</span></span><br><span class="line">  prometheus:</span><br><span class="line">    <span class="comment"># ... (image, ports 等保持不变) ...</span></span><br><span class="line">    volumes:</span><br><span class="line">      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml</span><br><span class="line">      - ./prometheus/rules.yml:/etc/prometheus/rules.yml  <span class="comment"># &lt;--- 新增：挂载规则文件</span></span><br><span class="line">      - prometheus_data:/prometheus</span><br><span class="line"></span><br><span class="line">  <span class="comment"># --- 新增服务: 告警中心 ---</span></span><br><span class="line">  alertmanager:</span><br><span class="line">    image: prom/alertmanager:latest</span><br><span class="line">    container_name: alertmanager</span><br><span class="line">    restart: always</span><br><span class="line">    volumes:</span><br><span class="line">      <span class="comment"># ⚠️ 关键点：将本地 config.yml 强制挂载为容器内的 alertmanager.yml 以覆盖默认配置</span></span><br><span class="line">      - ./alertmanager/config.yml:/etc/alertmanager/alertmanager.yml</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;9093:9093&quot;</span></span><br><span class="line">    networks:</span><br><span class="line">      - monitor-net</span><br></pre></td></tr></table></figure>

<h3 id="部署验证"><a href="#部署验证" class="headerlink" title="部署验证"></a>部署验证</h3><h4 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h4><p>由于修改了挂载卷配置，建议先删除旧容器再启动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/monitor</span><br><span class="line">docker compose down</span><br><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure>

<h4 id="压力测试（验证告警）"><a href="#压力测试（验证告警）" class="headerlink" title="压力测试（验证告警）"></a>压力测试（验证告警）</h4><p>安装压力测试工具 stress，模拟 CPU 飙升场景</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 模拟 2 个核满载，持续 120 秒</span></span><br><span class="line">stress -c 2 -t 120</span><br></pre></td></tr></table></figure>

<h4 id="观察流程"><a href="#观察流程" class="headerlink" title="观察流程"></a>观察流程</h4><ul>
<li><strong>触发</strong>：Prometheus 界面 (Status -&gt; Alerts) 中，<code>HostCpuUsageTooHigh</code> 状态由 Green -&gt; Yellow (Pending) -&gt; Red (Firing)。</li>
<li><strong>发送</strong>：Alertmanager 收到 Firing 信号，处理后投递邮件。</li>
<li><strong>恢复</strong>：stress 结束后，收到标题带 [Resolved] 的恢复邮件。</li>
</ul>
<h3 id="常见问题排查"><a href="#常见问题排查" class="headerlink" title="常见问题排查"></a>常见问题排查</h3><ul>
<li><strong>问题 1：</strong>Alertmanager 报错 connection refused 127.0.0.1:5001。<ul>
<li>原因：配置文件挂载路径错误，导致容器读取了镜像自带的默认配置（默认配置是指向本地 webhook 的）。</li>
<li>解决：确保 docker-compose 中挂载目标路径为 <code>/etc/alertmanager/alertmanager.yml</code>。</li>
</ul>
</li>
<li><strong>问题 2：</strong>邮件发送失败 535 Authentication failed。<ul>
<li>原因：使用了邮箱登录密码，而非 SMTP 专用授权码。</li>
</ul>
</li>
<li><strong>问题 3：</strong>容器无法联网 i&#x2F;o timeout。<ul>
<li>原因：Docker DNS 配置问题或云服务器安全组未放行。</li>
</ul>
</li>
<li><strong>问题 4：</strong>cAdvisor 报错 mountpoint for cpu not found <ul>
<li>原因：ubuntu 24.04 默认启用 <strong>Cgroup</strong> <strong>v2</strong>，而 docler hub 上的 cadvisor 旧版本只支持 <strong>Cgroup</strong> <strong>v1</strong></li>
<li><strong>解决：</strong>通过更改 <strong>zcube&#x2F;cadvisor</strong> 镜像并配置 <strong>privileged</strong> 模式解决版本兼容性问题</li>
</ul>
</li>
</ul>
<h2 id="基于-PLG-的轻量级日志分析"><a href="#基于-PLG-的轻量级日志分析" class="headerlink" title="基于 PLG 的轻量级日志分析"></a>基于 PLG 的轻量级日志分析</h2><blockquote>
<p>为了解决“出现故障需要登录服务器一条条查 logs”的低效问题，引入 PLG 技术栈 (Promtail + Loki + Grafana)。</p>
</blockquote>
<ul>
<li>优势：相比 ELK (Elasticsearch)，Loki 不建立全文索引，仅索引元数据（标签），内存占用极低，非常适合云服务器单机环境。</li>
<li>流向：Promtail (自动发现容器) -&gt; 采集日志 -&gt; Loki (存储与索引) -&gt; Grafana (统一查询)。</li>
</ul>
<h3 id="配置文件编写-2"><a href="#配置文件编写-2" class="headerlink" title="配置文件编写"></a>配置文件编写</h3><p>首先创建日志组件的专用目录：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">mkdir</span> <span class="string">-p</span> <span class="string">/opt/monitor/loki</span></span><br><span class="line"><span class="string">mkdir</span> <span class="string">-p</span> <span class="string">/opt/monitor/promtail</span></span><br></pre></td></tr></table></figure>

<h4 id="配置-Loki-存储端-loki-config-yaml"><a href="#配置-Loki-存储端-loki-config-yaml" class="headerlink" title="配置 Loki 存储端 (loki-config.yaml)"></a>配置 Loki 存储端 (<code>loki-config.yaml</code>)</h4><p>创建<code>/opt/monitor/loki/loki-config.yaml</code>，定义日志如何存储。采用本地文件系统存储，简单高效。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">auth_enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">http_listen_port:</span> <span class="number">3100</span></span><br><span class="line"></span><br><span class="line"><span class="attr">common:</span></span><br><span class="line">  <span class="attr">path_prefix:</span> <span class="string">/loki</span></span><br><span class="line">  <span class="attr">storage:</span></span><br><span class="line">    <span class="attr">filesystem:</span></span><br><span class="line">      <span class="attr">chunks_directory:</span> <span class="string">/loki/chunks</span></span><br><span class="line">      <span class="attr">rules_directory:</span> <span class="string">/loki/rules</span></span><br><span class="line">  <span class="attr">replication_factor:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">ring:</span></span><br><span class="line">    <span class="attr">instance_addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">kvstore:</span></span><br><span class="line">      <span class="attr">store:</span> <span class="string">inmemory</span></span><br><span class="line"></span><br><span class="line"><span class="attr">schema_config:</span></span><br><span class="line">  <span class="attr">configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">from:</span> <span class="number">2020-10-24</span></span><br><span class="line">      <span class="attr">store:</span> <span class="string">tsdb</span></span><br><span class="line">      <span class="attr">object_store:</span> <span class="string">filesystem</span></span><br><span class="line">      <span class="attr">schema:</span> <span class="string">v13</span></span><br><span class="line">      <span class="attr">index:</span></span><br><span class="line">        <span class="attr">prefix:</span> <span class="string">index_</span></span><br><span class="line">        <span class="attr">period:</span> <span class="string">24h</span></span><br></pre></td></tr></table></figure>

<h4 id="配置-Promtail-采集端-promtail-config-yaml"><a href="#配置-Promtail-采集端-promtail-config-yaml" class="headerlink" title="配置 Promtail 采集端 (promtail-config.yaml)"></a>配置 Promtail 采集端 (<code>promtail-config.yaml</code>)</h4><p>创建 <code>/opt/monitor/promtail/promtail-config.yaml</code>。、</p>
<blockquote>
<p>核心逻辑：通过挂载 Docker Socket，自动发现当前运行的所有容器，并利用 relabel 机制将 Docker 内部名称格式化为易读的标签。</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">http_listen_port:</span> <span class="number">9080</span></span><br><span class="line">  <span class="attr">grpc_listen_port:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">positions:</span></span><br><span class="line">  <span class="attr">filename:</span> <span class="string">/tmp/positions.yaml</span> <span class="comment"># 记录采集游标，防止重启后日志重复或丢失</span></span><br><span class="line"></span><br><span class="line"><span class="attr">clients:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">url:</span> <span class="string">http://loki:3100/loki/api/v1/push</span> <span class="comment"># 推送给 Loki</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">system</span></span><br><span class="line">    <span class="attr">docker_sd_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">unix:///var/run/docker.sock</span> <span class="comment"># 监听 Docker 事件</span></span><br><span class="line">        <span class="attr">refresh_interval:</span> <span class="string">5s</span></span><br><span class="line">    <span class="attr">relabel_configs:</span></span><br><span class="line">      <span class="comment"># 只保留有名称的容器</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">&#x27;__meta_docker_container_name&#x27;</span>]</span><br><span class="line">        <span class="attr">regex:</span> <span class="string">&#x27;/(.*)&#x27;</span></span><br><span class="line">        <span class="attr">target_label:</span> <span class="string">&#x27;container&#x27;</span> <span class="comment"># 重命名标签为 container，方便检索</span></span><br></pre></td></tr></table></figure>

<h3 id="服务编排更新-docker-compose-yml-1"><a href="#服务编排更新-docker-compose-yml-1" class="headerlink" title="服务编排更新 (docker-compose.yml)"></a>服务编排更新 (<code>docker-compose.yml</code>)</h3><p>编辑 <code>/opt/monitor/docker-compose.yml</code>，新增 Loki 和 Promtail 服务，并挂载必要的数据卷。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="comment"># ... (之前的 Prometheus, Grafana, Alertmanager 等保持不变) ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># --- 新增: 日志存储 Loki ---</span></span><br><span class="line">  <span class="attr">loki:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/loki:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">loki</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./loki/loki-config.yaml:/etc/loki/local-config.yaml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">loki_data:/loki</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3100:3100&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">monitor-net</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># --- 新增: 日志采集 Promtail ---</span></span><br><span class="line">  <span class="attr">promtail:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/promtail:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">promtail</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./promtail/promtail-config.yaml:/etc/promtail/config.yml</span></span><br><span class="line">      <span class="comment"># ⚠️ 关键挂载 1: 允许 Promtail 访问 Docker 守护进程以发现容器</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line">      <span class="comment"># ⚠️ 关键挂载 2: 允许 Promtail 读取实际的日志文件 (只读模式)</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/lib/docker/containers:/var/lib/docker/containers:ro</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">monitor-net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">prometheus_data:</span></span><br><span class="line">  <span class="attr">grafana_data:</span></span><br><span class="line">  <span class="attr">loki_data:</span> <span class="comment"># &lt;--- 别忘了新增这个卷用于持久化日志</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">monitor-net:</span></span><br></pre></td></tr></table></figure>

<h3 id="部署与-Grafana-配置"><a href="#部署与-Grafana-配置" class="headerlink" title="部署与 Grafana 配置"></a>部署与 Grafana 配置</h3><h4 id="重启服务-1"><a href="#重启服务-1" class="headerlink" title="重启服务"></a>重启服务</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">/opt/monitor</span></span><br><span class="line"><span class="string">docker</span> <span class="string">compose</span> <span class="string">up</span> <span class="string">-d</span></span><br><span class="line"><span class="comment"># 检查 loki 和 promtail 状态是否为 Up</span></span><br><span class="line"><span class="string">docker</span> <span class="string">compose</span> <span class="string">ps</span></span><br></pre></td></tr></table></figure>

<h4 id="在-Grafana-接入数据源"><a href="#在-Grafana-接入数据源" class="headerlink" title="在 Grafana 接入数据源"></a>在 Grafana 接入数据源</h4><ul>
<li>登录 Grafana -&gt; Connections -&gt; Data sources -&gt; Add new data source。</li>
<li>选择 Loki。</li>
<li>URL 填写：<a href="http://loki:3100。">http://loki:3100。</a></li>
<li>点击 Save &amp; Test，出现绿色提示 “Data source connected” 即成功。</li>
</ul>
<h3 id="如何进行日志排查"><a href="#如何进行日志排查" class="headerlink" title="如何进行日志排查"></a>如何进行日志排查</h3><ul>
<li>进入 Grafana 左侧菜单 Explore (探索)。</li>
<li>顶部数据源选择 Loki。</li>
<li>Label filters 选择 container &#x3D; 你的应用容器名 (例如 cadvisor)。</li>
<li>点击 Run query。</li>
<li>效果：可以看到实时的应用日志流。配合 Live 按钮，可以像在终端使用 <code>tail -f</code> 一样监控线上日志。</li>
</ul>
<hr>
<h2 id="简历上的项目描述"><a href="#简历上的项目描述" class="headerlink" title="简历上的项目描述"></a>简历上的项目描述</h2><p><strong>项目名称：基于 Docker 的云服务器监控平台</strong></p>
<p><strong>项目描述：</strong><br>针对单体云服务器缺乏可视化监控、故障排查困难的问题，基于 Docker 搭建了一套标准化的监控告警系统。实现了从硬件层到应用容器层的全方位可观测性。</p>
<p><strong>操作系统</strong>：Ubuntu 24.04</p>
<p><strong>技术栈</strong>：Docker + Prometheus + Grafana + Alertmanager + cAdvisor + Loki + Promtail </p>
<p><strong>核心技术：</strong></p>
<ul>
<li><strong>容器化基础设施</strong>：使用 <strong>Docker Compose</strong> 统一编排 <strong>Prometheus、Grafana、Loki</strong> 等 6 个服务组件，实现了“一键拉起”的标准化部署环境。</li>
<li><strong>多维度监控</strong>：通过 <strong>Node Exporter</strong> 采集宿主机 CPU 使用率、磁盘 IO 等核心指标；引入 <strong>cAdvisor</strong> 解决了 Docker 容器资源隔离不可见的问题，实现了对单容器内存泄漏的实时监测。</li>
<li><strong>可视化监控</strong>：基于 <strong>Grafana</strong> 自定义监控仪表盘，配置了 <strong>Prometheus 数据源</strong>，实现了服务器资源使用率的秒级刷新展示。</li>
<li><strong>自动化告警</strong>：编写 PromQL 规则（如 CPU &gt; 90%），结合 <strong>Alertmanager <strong>实现了邮件实时告警，经</strong>压测</strong>验证，平均故障响应时间缩短至 2 分钟以内</li>
<li><strong>日志聚合分析：</strong>引入**Promtail + Loki + Grafana **技术栈，实现 docker 容器日志的自动化采集和聚合，与传统 ELK 方案相比，资源占用更低</li>
</ul>
<hr>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://github.com/TnTTNG">ZhanHui TnTTNG</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://github.com/TnTTNG/2026/01/31/%E5%9F%BA%E4%BA%8E%20Docker%20+%20Prometheus%20+%20Grafana%20%E7%9A%84%E5%85%A8%E6%A0%88%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/">https://github.com/TnTTNG/2026/01/31/%E5%9F%BA%E4%BA%8E%20Docker%20+%20Prometheus%20+%20Grafana%20%E7%9A%84%E5%85%A8%E6%A0%88%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://github.com/TnTTNG" target="_blank">(´▽`ʃ♡ƪ)</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/TnTTNG/tags/%E6%95%99%E7%A8%8B/">教程</a><a class="post-meta__tags" href="/TnTTNG/tags/Docker/">Docker</a></div><div class="post-share"><div class="social-share" data-image="/TnTTNG/img/brain.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/TnTTNG/2026/02/04/Nginx%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" title="Nginx 快速入门"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Nginx 快速入门</div></div><div class="info-2"><div class="info-item-1">介绍 Nginx 是一个高性能的 Web 服务器，主要负责处理客户端（浏览器）和后端服务器（应用）之间的通信。    用途 nginx 最核心的三大用途  反向代理 负载均衡 静态资源服务   反向代理 原理：用户访问网站时，其实是连接到 Nginx，由 Nginx 帮忙去后端获取数据再返回给用户。  价值： 安全：隐藏了后端服务器的真实 IP，保护核心数据。   统一：所有请求由 Nginx 统一接管，便于管理。    负载均衡 原理：当访问量巨大时，Nginx 会按照规则（如轮询、权重）将请求平均分配给多台后端服务器。   价值： 稳定： 防止某一台服务器因流量过大而累死（宕机)。 高可用： 如果一台坏了，Nginx 自动把请求转给其他正常的服务器。    动静分离 原理： 将图片、CSS、JS、HTML 等不需要计算的静态文件，直接由 Nginx 快速返回，不经过后端应用服务器。 价值： 提速：Nginx 处理静态文件的速度远超 Tomcat&#x2F;Python 等应用服务器。 减负：让昂贵的后端算力专心处理复杂的业务逻辑。    总结 如果把一个 Web 系统比作一家...</div></div></div></a><a class="pagination-related  no-desc" href="/TnTTNG/2026/01/31/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/" title="我的第一篇博客"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">我的第一篇博客</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/TnTTNG/img/brain.jpg" onerror="this.onerror=null;this.src='/TnTTNG/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">ZhanHui TnTTNG</div><div class="author-info-description">謝雅婷のプライベート大公開！</div><div class="site-data"><a href="/TnTTNG/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/TnTTNG/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/TnTTNG/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/TnTTNG" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF%E4%B8%8E%E6%9E%B6%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">项目背景与架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">2.</span> <span class="toc-text">环境准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99"><span class="toc-number">3.</span> <span class="toc-text">配置文件编写</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-Prometheus-prometheus-yml"><span class="toc-number">3.1.</span> <span class="toc-text">配置 Prometheus (prometheus.yml)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E7%BC%96%E6%8E%92%E6%96%87%E4%BB%B6-docker-compose-yml"><span class="toc-number">3.2.</span> <span class="toc-text">编写编排文件 (docker-compose.yml)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E4%B8%8E%E5%90%AF%E5%8A%A8"><span class="toc-number">4.</span> <span class="toc-text">部署与启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Grafana-%E6%B7%B1%E5%BA%A6%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">5.</span> <span class="toc-text">Grafana 深度配置与可视化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E4%B8%AD%E6%96%87%E7%95%8C%E9%9D%A2"><span class="toc-number">5.1.</span> <span class="toc-text">设置中文界面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">5.2.</span> <span class="toc-text">配置数据源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E6%A0%B8%E5%BF%83%E4%BB%AA%E8%A1%A8%E7%9B%98"><span class="toc-number">5.3.</span> <span class="toc-text">导入核心仪表盘</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-Alertmanager-%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E5%91%8A%E8%AD%A6%E9%97%AD%E7%8E%AF"><span class="toc-number">6.</span> <span class="toc-text">基于 Alertmanager 的自动化告警闭环</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99-1"><span class="toc-number">6.1.</span> <span class="toc-text">配置文件编写</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%91%8A%E8%AD%A6%E8%A7%84%E5%88%99-rules-yml"><span class="toc-number">6.1.1.</span> <span class="toc-text">创建告警规则 (rules.yml)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-Alertmanager-config-yml"><span class="toc-number">6.1.2.</span> <span class="toc-text">配置 Alertmanager (config.yml)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E8%81%94-Prometheus"><span class="toc-number">6.1.3.</span> <span class="toc-text">关联 Prometheus</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%BC%96%E6%8E%92%E6%9B%B4%E6%96%B0-docker-compose-yml"><span class="toc-number">6.2.</span> <span class="toc-text">服务编排更新 (docker-compose.yml)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E9%AA%8C%E8%AF%81"><span class="toc-number">6.3.</span> <span class="toc-text">部署验证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%90%AF%E6%9C%8D%E5%8A%A1"><span class="toc-number">6.3.1.</span> <span class="toc-text">重启服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%EF%BC%88%E9%AA%8C%E8%AF%81%E5%91%8A%E8%AD%A6%EF%BC%89"><span class="toc-number">6.3.2.</span> <span class="toc-text">压力测试（验证告警）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E6%B5%81%E7%A8%8B"><span class="toc-number">6.3.3.</span> <span class="toc-text">观察流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5"><span class="toc-number">6.4.</span> <span class="toc-text">常见问题排查</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-PLG-%E7%9A%84%E8%BD%BB%E9%87%8F%E7%BA%A7%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="toc-number">7.</span> <span class="toc-text">基于 PLG 的轻量级日志分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99-2"><span class="toc-number">7.1.</span> <span class="toc-text">配置文件编写</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-Loki-%E5%AD%98%E5%82%A8%E7%AB%AF-loki-config-yaml"><span class="toc-number">7.1.1.</span> <span class="toc-text">配置 Loki 存储端 (loki-config.yaml)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-Promtail-%E9%87%87%E9%9B%86%E7%AB%AF-promtail-config-yaml"><span class="toc-number">7.1.2.</span> <span class="toc-text">配置 Promtail 采集端 (promtail-config.yaml)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%BC%96%E6%8E%92%E6%9B%B4%E6%96%B0-docker-compose-yml-1"><span class="toc-number">7.2.</span> <span class="toc-text">服务编排更新 (docker-compose.yml)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E4%B8%8E-Grafana-%E9%85%8D%E7%BD%AE"><span class="toc-number">7.3.</span> <span class="toc-text">部署与 Grafana 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%90%AF%E6%9C%8D%E5%8A%A1-1"><span class="toc-number">7.3.1.</span> <span class="toc-text">重启服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8-Grafana-%E6%8E%A5%E5%85%A5%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">7.3.2.</span> <span class="toc-text">在 Grafana 接入数据源</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%97%A5%E5%BF%97%E6%8E%92%E6%9F%A5"><span class="toc-number">7.4.</span> <span class="toc-text">如何进行日志排查</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8E%86%E4%B8%8A%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%8F%8F%E8%BF%B0"><span class="toc-number">8.</span> <span class="toc-text">简历上的项目描述</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/TnTTNG/2026/02/04/Nginx%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" title="Nginx 快速入门">Nginx 快速入门</a><time datetime="2026-02-04T15:01:00.000Z" title="发表于 2026-02-04 23:01:00">2026-02-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/TnTTNG/2026/01/31/%E5%9F%BA%E4%BA%8E%20Docker%20+%20Prometheus%20+%20Grafana%20%E7%9A%84%E5%85%A8%E6%A0%88%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/" title="基于 Docker + Prometheus + Grafana 的全栈监控平台">基于 Docker + Prometheus + Grafana 的全栈监控平台</a><time datetime="2026-01-31T12:31:00.000Z" title="发表于 2026-01-31 20:31:00">2026-01-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/TnTTNG/2026/01/31/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/" title="我的第一篇博客">我的第一篇博客</a><time datetime="2026-01-31T04:15:07.000Z" title="发表于 2026-01-31 12:15:07">2026-01-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/TnTTNG/2026/01/29/hello-world/" title="Hello World">Hello World</a><time datetime="2026-01-29T18:55:04.096Z" title="发表于 2026-01-30 02:55:04">2026-01-30</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://my-static-website-bucket.oss-cn-guangzhou.aliyuncs.com/stewie-griffin-smirk-vi3r1fbdetfuir8e.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By ZhanHui TnTTNG</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.4</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/TnTTNG/js/utils.js?v=5.5.4"></script><script src="/TnTTNG/js/main.js?v=5.5.4"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>